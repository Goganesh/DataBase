--ГЕНЕРАЦИЯ МОДЕЛИ ДАННЫХ

CREATE database TRADEBASE;
CREATE USER 'TRADEBASE_USER'@'%' IDENTIFIED WITH caching_sha2_password BY '12345';
GRANT ALL PRIVILEGES ON TRADEBASE.* TO 'TRADEBASE_USER'@'%';
USE TRADEBASE;


CREATE TABLE STATUSES
(
    ID VARCHAR(32) PRIMARY KEY,
    TYPE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE LOT_TYPES
(
    ID VARCHAR(32) PRIMARY KEY,
    PARENT_ID VARCHAR(32),
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_TYPES
(
    ID VARCHAR(32) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_CATEGORIES
(
    ID VARCHAR(32) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE CURRENCIES
(
    ID VARCHAR(32) PRIMARY KEY,
    CODE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE PERSONS
(
    ID VARCHAR(32) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    SURNAME VARCHAR(255) NOT NULL,
    PATRONYMIC VARCHAR(255) NOT NULL,
    MAIL VARCHAR(255) NOT NULL,
    PHONENUMBER VARCHAR(255) NOT NULL,
    PERSON_STATUS_ID VARCHAR(32),
	CONSTRAINT PERSON_STATUS_ID_FK
	FOREIGN KEY (PERSON_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE EVENTS
(
    ID VARCHAR(32) PRIMARY KEY,
    DESCRIPTION VARCHAR(255) NOT NULL,
    EVENT_STATUS_ID VARCHAR(32),
    EVENT_TYPE_ID VARCHAR(32),
    START_DATE DATE,
    END_DATE DATE,
    PRICE INT,
    CURRENCY_ID VARCHAR(32),
    PERSON_ID VARCHAR(32),
	CONSTRAINT EVENT_STATUS_ID_FK
	FOREIGN KEY (EVENT_STATUS_ID)
        REFERENCES STATUSES(id),
	CONSTRAINT EVENT_TYPE_ID_FK
	FOREIGN KEY (EVENT_TYPE_ID)
        REFERENCES EVENT_TYPES(id),
    CONSTRAINT CURRENCY_ID_FK
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
    CONSTRAINT PERSON_ID_FK
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id)
);

CREATE TABLE LOTS
(
    ID VARCHAR(32) PRIMARY KEY,
    DESCRIPTION VARCHAR(255) NOT NULL,
    ATTRIBUTES JSON,
    LOT_TYPE_ID VARCHAR(32),
    OWNER_ID VARCHAR(32),
    LOT_STATUS_ID VARCHAR(32),
    CONSTRAINT LOT_TYPE_ID_FK
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id),
	CONSTRAINT OWNER_ID_FK
	FOREIGN KEY (OWNER_ID)
        REFERENCES PERSONS(id),
	CONSTRAINT LOT_STATUS_ID_FK
	FOREIGN KEY (LOT_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE LOT_TO_EVENT
(
    ID VARCHAR(32) PRIMARY KEY,
    LOT_ID VARCHAR(32),
    EVENT_ID VARCHAR(32),
	CONSTRAINT LOT_ID_FK
	FOREIGN KEY (LOT_ID)
        REFERENCES LOTS(id),
	CONSTRAINT EVENT_ID_FK
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE CATEGORY_TO_EVENT
(
    ID VARCHAR(32) PRIMARY KEY,
    EVENT_CATEGORY_ID VARCHAR(32),
    EVENT_ID VARCHAR(32),
	CONSTRAINT EVENT_CATEGORY_ID_FK
	FOREIGN KEY (EVENT_CATEGORY_ID)
        REFERENCES EVENT_CATEGORIES(id),
	CONSTRAINT EVENT_ID_FK1
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE ORDERS
(
    ID VARCHAR(32) PRIMARY KEY,
    PERSON_ID VARCHAR(32),
    ORDER_STATUS_ID VARCHAR(32),
    PRICE INT,
    CURRENCY_ID VARCHAR(32),
    EVENT_ID VARCHAR(32),
    ORDER_DATE TIMESTAMP,
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id),
	FOREIGN KEY (ORDER_STATUS_ID)
        REFERENCES STATUSES(id),
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE LOT_TYPE_ATTRIBUTES
(
    ID VARCHAR(32) PRIMARY KEY,
    LOT_TYPE_ID VARCHAR(32),
    ATTR_NAME VARCHAR(255) NOT NULL,
    ATTR_TYPE VARCHAR(255) NOT NULL,
	CONSTRAINT LOT_TYPE_ID_FK1
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id)
);

--ГЕНЕРАЦИЯ ДАННЫХ

DELIMITER //
;

CREATE PROCEDURE INIT_DATA()
BEGIN

INSERT INTO STATUSES
(ID, TYPE, NAME)
VALUES
('FE0B8703C7174365B7E57C86777AFFFC', 'PERSON_STATUS', 'ACTIVE'),
('FCA7874EB9834212BBF000EFE39D145E', 'PERSON_STATUS', 'PASSIVE'),
('79520248CBF0400C87D489E8EFA6277A', 'LOT_STATUS', 'LOT_TRANSFER'),
('290B8F1F19BD46A8A2FD7ABDC40B5B27', 'LOT_STATUS', 'APPROVED'),
('8F49CBCCF8DE4C4AA3DC94027E42F429', 'LOT_STATUS', 'TRADING'),
('36440F43A16B47708083915E3F33CA9D', 'LOT_STATUS', 'READY_FOR_TRADE'),
('23291B645B344A6F8D8063FC1FD0CE1C', 'LOT_STATUS', 'CHEKING_FOR_TRADE'),
('AD3297FC43184601BB02902211239AFC', 'LOT_STATUS', 'NEW'),
('9F8956E2CC984E97960DB77824F5E013', 'EVENT_STATUS', 'ARCHIVED'),
('CEEA746A099F4BD186430CEB326BB699', 'EVENT_STATUS', 'LOT_TRANSFER'),
('CDF05E06AD1E4D3093194262AFB6C20E', 'EVENT_STATUS', 'APPROVED'),
('B97FDF93142F44B0BEF1ED4EB4CB29BC', 'EVENT_STATUS', 'TRADING'),
('582F930F18F743FBA6E04385BF4AB80F', 'EVENT_STATUS', 'IN_WORK'),
('48B1B224B41343FA94BABD2670FECFA1', 'EVENT_STATUS', 'CANCELED'),
('6973301EE6D64CC986832ADD326BCDD7', 'ORDER_STATUS', 'APPVORED'),
('6349FDFD4A174D0FB38A0134BAE98645', 'ORDER_STATUS', 'BEATED'),
('985B739599894B0FAA5AD31A4125DDB3', 'ORDER_STATUS', 'CANCELED')
;

INSERT INTO CURRENCIES
(ID, CODE, NAME)
VALUES
('B7F66719F15147F4A4195AFFBA89090C', 'RUB', 'РОССИЙСКИЙ РУБЛЬ'),
('95A1EF0DDA5045E998C62BF2F6F0A627', 'USD', 'ДОЛЛАР США')
;

INSERT INTO LOT_TYPES
(ID, PARENT_ID, NAME)
VALUES
('CC385007F2384C47BF238EE8537C4239', NULL, 'ART'),
('D6CC8DE767D84F42967E3AFC2D4468EC', 'CC385007F2384C47BF238EE8537C4239', 'PICTUTE'),
('B1AA58334D1C4BD68070FFBA9939E423', 'CC385007F2384C47BF238EE8537C4239', 'STATUE')
;

INSERT INTO EVENT_TYPES
(ID, NAME)
VALUES
('D1412F0740144ACF8A76ACFE9520F9F6', 'SIMPLE TRADE')
;

INSERT INTO EVENT_CATEGORIES
(ID, NAME)
VALUES
('DC195AB38B8A4B0DB437692AC3DC5A09', 'TRADE_LESS_100_DOLLARS'),
('B54C4F0904454675BE477B9E661136D2', 'PREMIUM_TRADE'),
('2AD04A2F173C4CD98CCD0B4786247196', 'ART_TRADING')
;

INSERT INTO PERSONS
(ID, NAME, SURNAME, PATRONYMIC, MAIL, PHONENUMBER, PERSON_STATUS_ID)
VALUES
('3E4F30130AF646C0A2E3D29EA92169B2', 'GEORGY', 'BASILADZE', 'TAMAZOVICH', 'BASILADZE@MAIL.RU', '9267257128', 'FE0B8703C7174365B7E57C86777AFFFC'),
('1514DECE19CC4820AA6B688945B2F27E', 'ANDRO', 'BASILADZE', 'TAMAZOVICH', 'ANDROBASILADZE@MAIL.RU', '9268168313', 'FCA7874EB9834212BBF000EFE39D145E'),
('A27487B604194830941EC2969F9AA05A', 'DENIS', 'IVIN', 'VLADIMIROVICH', 'IVIN@GMAIL.COM', '9267257777', 'FE0B8703C7174365B7E57C86777AFFFC')
;

INSERT INTO LOTS
(ID, DESCRIPTION, ATTRIBUTES, LOT_TYPE_ID, OWNER_ID, LOT_STATUS_ID)
VALUES
('A25E75A9DE714FEA99EE2FAFD7ABFDF5', 'СТАТУЯ ЛФЗ - СИБИРСКИЙ КОТ', '{"материал": "керамика", "производитель": "ЛФЗ"}', 'B1AA58334D1C4BD68070FFBA9939E423', '3E4F30130AF646C0A2E3D29EA92169B2', '36440F43A16B47708083915E3F33CA9D'),
('0C0CD1A1E944415EBC523792BA3C9985', 'СТАТУЯ ЛФЗ - ЦЫГАНКА', '{"материал": "фарфор", "производитель": "ЛФЗ"}', 'B1AA58334D1C4BD68070FFBA9939E423', '3E4F30130AF646C0A2E3D29EA92169B2', '36440F43A16B47708083915E3F33CA9D'),
('4EB25121F5144089AC6E1537C1CE02F5', 'СТАТУЯ ЛФЗ - ПОЭТ', '{"материал": "фарфор", "производитель": "ЛФЗ"}', 'B1AA58334D1C4BD68070FFBA9939E423', '3E4F30130AF646C0A2E3D29EA92169B2', '23291B645B344A6F8D8063FC1FD0CE1C')
;

INSERT INTO EVENTS
(ID, DESCRIPTION, EVENT_STATUS_ID, EVENT_TYPE_ID, START_DATE, END_DATE, PRICE, CURRENCY_ID, PERSON_ID)
VALUES
('CC0E42D500844C55844E480410BA68D7', 'АУКЦИОН РАРИТЕТНЫХ СТАТУЭТОК ЗАВОДА ЛФЗ', 'B97FDF93142F44B0BEF1ED4EB4CB29BC', 'D1412F0740144ACF8A76ACFE9520F9F6', '2020-12-27', '2020-12-29', 2500, '95A1EF0DDA5045E998C62BF2F6F0A627', '3E4F30130AF646C0A2E3D29EA92169B2')
;

INSERT INTO LOT_TO_EVENT
(ID, LOT_ID, EVENT_ID)
VALUES
('EC438CCE0B2D4224AD57D97981485040', 'A25E75A9DE714FEA99EE2FAFD7ABFDF5', 'CC0E42D500844C55844E480410BA68D7'),
('8DAE27E1FFDB47EAB15343105B7533AE', '0C0CD1A1E944415EBC523792BA3C9985', 'CC0E42D500844C55844E480410BA68D7')
;

INSERT INTO ORDERS
(ID, PERSON_ID, ORDER_STATUS_ID, PRICE, CURRENCY_ID, EVENT_ID)
VALUES
('6D0C5B08BFDB45009DC7FA277D5CA203', 'A27487B604194830941EC2969F9AA05A', '6349FDFD4A174D0FB38A0134BAE98645', 700, 'B7F66719F15147F4A4195AFFBA89090C', 'CC0E42D500844C55844E480410BA68D7'),
('9274FDE2EB674EA98B87EA417095F38D', '1514DECE19CC4820AA6B688945B2F27E', '6973301EE6D64CC986832ADD326BCDD7', 1200, 'B7F66719F15147F4A4195AFFBA89090C', 'CC0E42D500844C55844E480410BA68D7')
;

END //

DELIMITER ;
//

BEGIN
CALL INIT_DATA();
COMMIT;
