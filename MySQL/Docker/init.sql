--ГЕНЕРАЦИЯ МОДЕЛИ ДАННЫХ

CREATE database TRADEBASE;
CREATE USER 'TRADEBASE_USER'@'%' IDENTIFIED WITH caching_sha2_password BY '12345';
GRANT ALL PRIVILEGES ON TRADEBASE.* TO 'TRADEBASE_USER'@'%';
USE TRADEBASE;

CREATE TABLE STATUSES
(
    ID binary(16) PRIMARY KEY,
    TYPE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE LOT_TYPES
(
    ID binary(16) PRIMARY KEY,
    PARENT_ID binary(16),
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_TYPES
(
    ID binary(16) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_CATEGORIES
(
    ID binary(16) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE CURRENCIES
(
    ID binary(16) PRIMARY KEY,
    CODE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE PERSONS
(
    ID binary(16) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    SURNAME VARCHAR(255) NOT NULL,
    PATRONYMIC VARCHAR(255) NOT NULL,
    MAIL VARCHAR(255) NOT NULL,
    PHONENUMBER VARCHAR(255) NOT NULL,
    PERSON_STATUS_ID binary(16),
	FOREIGN KEY (PERSON_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE EVENTS
(
    ID binary(16) PRIMARY KEY,
    DESCRIPTION VARCHAR(255) NOT NULL,
    EVENT_STATUS_ID binary(16),
    EVENT_TYPE_ID binary(16),
    START_DATE DATE,
    END_DATE DATE,
    PRICE INT,
    CURRENCY_ID binary(16),
    PERSON_ID binary(16),
	FOREIGN KEY (EVENT_STATUS_ID)
        REFERENCES STATUSES(id),
	FOREIGN KEY (EVENT_TYPE_ID)
        REFERENCES EVENT_TYPES(id),
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id)
);

CREATE TABLE LOTS
(
    ID binary(16) PRIMARY KEY,
    DESCRIPTION VARCHAR(255) NOT NULL,
    ATTRIBUTES JSON,
    LOT_TYPE_ID binary(16),
    OWNER_ID binary(16),
    LOT_STATUS_ID binary(16),
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id),
	FOREIGN KEY (OWNER_ID)
        REFERENCES PERSONS(id),
	FOREIGN KEY (LOT_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE LOT_TO_EVENT
(
    ID binary(16) PRIMARY KEY,
    LOT_ID binary(16),
    EVENT_ID binary(16),
	FOREIGN KEY (LOT_ID)
        REFERENCES LOTS(id),
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE CATEGORY_TO_EVENT
(
    ID binary(16) PRIMARY KEY,
    EVENT_CATEGORY_ID binary(16),
    EVENT_ID binary(16),
	FOREIGN KEY (EVENT_CATEGORY_ID)
        REFERENCES EVENT_CATEGORIES(id),
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE ORDERS
(
    ID binary(16) PRIMARY KEY,
    PERSON_ID binary(16),
    ORDER_STATUS_ID binary(16),
    PRICE INT,
    CURRENCY_ID binary(16),
    EVENT_ID binary(16),
    ORDER_DATE TIMESTAMP,
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id),
	FOREIGN KEY (ORDER_STATUS_ID)
        REFERENCES STATUSES(id),
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE LOT_TYPE_ATTRIBUTES
(
    ID binary(16) PRIMARY KEY,
    LOT_TYPE_ID binary(16),
    ATTR_NAME VARCHAR(255) NOT NULL,
    ATTR_TYPE VARCHAR(255) NOT NULL,
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id)
);

--ГЕНЕРАЦИЯ ДАННЫХ

INSERT INTO STATUSES
(ID, TYPE, NAME)
VALUES
(UUID_TO_BIN('FE0B8703C7174365B7E57C86777AFFFC'), 'PERSON_STATUS', 'ACTIVE'),
(UUID_TO_BIN('FCA7874EB9834212BBF000EFE39D145E'), 'PERSON_STATUS', 'PASSIVE'),
(UUID_TO_BIN('79520248CBF0400C87D489E8EFA6277A'), 'LOT_STATUS', 'LOT_TRANSFER'),
(UUID_TO_BIN('290B8F1F19BD46A8A2FD7ABDC40B5B27'), 'LOT_STATUS', 'APPROVED'),
(UUID_TO_BIN('8F49CBCCF8DE4C4AA3DC94027E42F429'), 'LOT_STATUS', 'TRADING'),
(UUID_TO_BIN('36440F43A16B47708083915E3F33CA9D'), 'LOT_STATUS', 'READY_FOR_TRADE'),
(UUID_TO_BIN('23291B645B344A6F8D8063FC1FD0CE1C'), 'LOT_STATUS', 'CHEKING_FOR_TRADE'),
(UUID_TO_BIN('AD3297FC43184601BB02902211239AFC'), 'LOT_STATUS', 'NEW'),
(UUID_TO_BIN('9F8956E2CC984E97960DB77824F5E013'), 'EVENT_STATUS', 'ARCHIVED'),
(UUID_TO_BIN('CEEA746A099F4BD186430CEB326BB699'), 'EVENT_STATUS', 'LOT_TRANSFER'),
(UUID_TO_BIN('CDF05E06AD1E4D3093194262AFB6C20E'), 'EVENT_STATUS', 'APPROVED'),
(UUID_TO_BIN('B97FDF93142F44B0BEF1ED4EB4CB29BC'), 'EVENT_STATUS', 'TRADING'),
(UUID_TO_BIN('582F930F18F743FBA6E04385BF4AB80F'), 'EVENT_STATUS', 'IN_WORK'),
(UUID_TO_BIN('48B1B224B41343FA94BABD2670FECFA1'), 'EVENT_STATUS', 'CANCELED'),
(UUID_TO_BIN('6973301EE6D64CC986832ADD326BCDD7'), 'ORDER_STATUS', 'APPVORED'),
(UUID_TO_BIN('6349FDFD4A174D0FB38A0134BAE98645'), 'ORDER_STATUS', 'BEATED'),
(UUID_TO_BIN('985B739599894B0FAA5AD31A4125DDB3'), 'ORDER_STATUS', 'CANCELED')
;

INSERT INTO CURRENCIES
(ID, CODE, NAME)
VALUES
(UUID_TO_BIN('B7F66719F15147F4A4195AFFBA89090C'), 'RUB', 'РОССИЙСКИЙ РУБЛЬ'),
(UUID_TO_BIN('95A1EF0DDA5045E998C62BF2F6F0A627'), 'USD', 'ДОЛЛАР США')
;

INSERT INTO LOT_TYPES
(ID, PARENT_ID, NAME)
VALUES
(UUID_TO_BIN('CC385007F2384C47BF238EE8537C4239'), NULL, 'ART'),
(UUID_TO_BIN('D6CC8DE767D84F42967E3AFC2D4468EC'), UUID_TO_BIN('CC385007F2384C47BF238EE8537C4239'), 'PICTUTE'),
(UUID_TO_BIN('B1AA58334D1C4BD68070FFBA9939E423'), UUID_TO_BIN('CC385007F2384C47BF238EE8537C4239'), 'STATUE')
;

INSERT INTO EVENT_TYPES
(ID, NAME)
VALUES
(UUID_TO_BIN('D1412F0740144ACF8A76ACFE9520F9F6'), 'SIMPLE TRADE')
;

INSERT INTO EVENT_CATEGORIES
(ID, NAME)
VALUES
(UUID_TO_BIN('DC195AB38B8A4B0DB437692AC3DC5A09'), 'TRADE_LESS_100_DOLLARS'),
(UUID_TO_BIN('B54C4F0904454675BE477B9E661136D2'), 'PREMIUM_TRADE'),
(UUID_TO_BIN('2AD04A2F173C4CD98CCD0B4786247196'), 'ART_TRADING')
;

INSERT INTO PERSONS
(ID, NAME, SURNAME, PATRONYMIC, MAIL, PHONENUMBER, PERSON_STATUS_ID)
VALUES
(UUID_TO_BIN('3E4F30130AF646C0A2E3D29EA92169B2'), 'GEORGY', 'BASILADZE', 'TAMAZOVICH', 'BASILADZE@MAIL.RU', '9267257128', UUID_TO_BIN('FE0B8703C7174365B7E57C86777AFFFC')),
(UUID_TO_BIN('1514DECE19CC4820AA6B688945B2F27E'), 'ANDRO', 'BASILADZE', 'TAMAZOVICH', 'ANDROBASILADZE@MAIL.RU', '9268168313', UUID_TO_BIN('FCA7874EB9834212BBF000EFE39D145E')),
(UUID_TO_BIN('A27487B604194830941EC2969F9AA05A'), 'DENIS', 'IVIN', 'VLADIMIROVICH', 'IVIN@GMAIL.COM', '9267257777', UUID_TO_BIN('FE0B8703C7174365B7E57C86777AFFFC'))
;

INSERT INTO LOTS
(ID, DESCRIPTION, ATTRIBUTES, LOT_TYPE_ID, OWNER_ID, LOT_STATUS_ID)
VALUES
(UUID_TO_BIN('A25E75A9DE714FEA99EE2FAFD7ABFDF5'), 'СТАТУЯ ЛФЗ - СИБИРСКИЙ КОТ', '{"материал": "керамика", "производитель": "ЛФЗ"}', UUID_TO_BIN('B1AA58334D1C4BD68070FFBA9939E423'), UUID_TO_BIN('3E4F30130AF646C0A2E3D29EA92169B2'), UUID_TO_BIN('36440F43A16B47708083915E3F33CA9D')),
(UUID_TO_BIN('0C0CD1A1E944415EBC523792BA3C9985'), 'СТАТУЯ ЛФЗ - ЦЫГАНКА', '{"материал": "фарфор", "производитель": "ЛФЗ"}', UUID_TO_BIN('B1AA58334D1C4BD68070FFBA9939E423'), UUID_TO_BIN('3E4F30130AF646C0A2E3D29EA92169B2'), UUID_TO_BIN('36440F43A16B47708083915E3F33CA9D')),
(UUID_TO_BIN('4EB25121F5144089AC6E1537C1CE02F5'), 'СТАТУЯ ЛФЗ - ПОЭТ', '{"материал": "фарфор", "производитель": "ЛФЗ"}', UUID_TO_BIN('B1AA58334D1C4BD68070FFBA9939E423'), UUID_TO_BIN('3E4F30130AF646C0A2E3D29EA92169B2'), UUID_TO_BIN('23291B645B344A6F8D8063FC1FD0CE1C'))
;

INSERT INTO EVENTS
(ID, DESCRIPTION, EVENT_STATUS_ID, EVENT_TYPE_ID, START_DATE, END_DATE, PRICE, CURRENCY_ID, PERSON_ID)
VALUES
(UUID_TO_BIN('CC0E42D500844C55844E480410BA68D7'), 'АУКЦИОН РАРИТЕТНЫХ СТАТУЭТОК ЗАВОДА ЛФЗ', UUID_TO_BIN('B97FDF93142F44B0BEF1ED4EB4CB29BC'), UUID_TO_BIN('D1412F0740144ACF8A76ACFE9520F9F6'), '2020-12-27', '2020-12-29', 2500, UUID_TO_BIN('95A1EF0DDA5045E998C62BF2F6F0A627'), UUID_TO_BIN('3E4F30130AF646C0A2E3D29EA92169B2'))
;

INSERT INTO LOT_TO_EVENT
(ID, LOT_ID, EVENT_ID)
VALUES
(UUID_TO_BIN('EC438CCE0B2D4224AD57D97981485040'), UUID_TO_BIN('A25E75A9DE714FEA99EE2FAFD7ABFDF5'), UUID_TO_BIN('CC0E42D500844C55844E480410BA68D7')),
(UUID_TO_BIN('8DAE27E1FFDB47EAB15343105B7533AE'), UUID_TO_BIN('0C0CD1A1E944415EBC523792BA3C9985'), UUID_TO_BIN('CC0E42D500844C55844E480410BA68D7'))
;