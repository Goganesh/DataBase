--ГЕНЕРАЦИЯ МОДЕЛИ ДАННЫХ

CREATE database TRADEBASE;
CREATE USER 'TRADEBASE_USER'@'%' IDENTIFIED WITH caching_sha2_password BY '12345';
GRANT ALL PRIVILEGES ON TRADEBASE.* TO 'TRADEBASE_USER'@'%';
USE TRADEBASE;


CREATE TABLE STATUSES
(
    ID VARCHAR(36) PRIMARY KEY,
    TYPE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE LOT_TYPES
(
    ID VARCHAR(36) PRIMARY KEY,
    PARENT_ID VARCHAR(36),
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_TYPES
(
    ID VARCHAR(36) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE EVENT_CATEGORIES
(
    ID VARCHAR(36) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE CURRENCIES
(
    ID VARCHAR(36) PRIMARY KEY,
    CODE VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL
);

CREATE TABLE PERSONS
(
    ID VARCHAR(36) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    SURNAME VARCHAR(255) NOT NULL,
    PATRONYMIC VARCHAR(255) NOT NULL,
    MAIL VARCHAR(255) NOT NULL,
    PHONENUMBER VARCHAR(255) NOT NULL,
    PERSON_STATUS_ID VARCHAR(36),
	CONSTRAINT PERSON_STATUS_ID_FK
	FOREIGN KEY (PERSON_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE EVENTS
(
    ID VARCHAR(36) PRIMARY KEY,
    DESCRIPTION VARCHAR(255) NOT NULL,
    EVENT_STATUS_ID VARCHAR(36),
    EVENT_TYPE_ID VARCHAR(36),
    START_DATE DATE,
    END_DATE DATE,
    PRICE INT,
    CURRENCY_ID VARCHAR(36),
    PERSON_ID VARCHAR(36),
	CONSTRAINT EVENT_STATUS_ID_FK
	FOREIGN KEY (EVENT_STATUS_ID)
        REFERENCES STATUSES(id),
	CONSTRAINT EVENT_TYPE_ID_FK
	FOREIGN KEY (EVENT_TYPE_ID)
        REFERENCES EVENT_TYPES(id),
    CONSTRAINT CURRENCY_ID_FK
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
    CONSTRAINT PERSON_ID_FK
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id)
);

CREATE TABLE LOTS
(
    ID VARCHAR(36) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    DESCRIPTION VARCHAR(255) NOT NULL,
    ATTRIBUTES JSON,
    LOT_TYPE_ID VARCHAR(36),
    OWNER_ID VARCHAR(36),
    LOT_STATUS_ID VARCHAR(36),
    CONSTRAINT LOT_TYPE_ID_FK
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id),
	CONSTRAINT OWNER_ID_FK
	FOREIGN KEY (OWNER_ID)
        REFERENCES PERSONS(id),
	CONSTRAINT LOT_STATUS_ID_FK
	FOREIGN KEY (LOT_STATUS_ID)
        REFERENCES STATUSES(id)
);

CREATE TABLE LOT_TO_EVENT
(
    ID VARCHAR(36) PRIMARY KEY,
    LOT_ID VARCHAR(36),
    EVENT_ID VARCHAR(36),
	CONSTRAINT LOT_ID_FK
	FOREIGN KEY (LOT_ID)
        REFERENCES LOTS(id),
	CONSTRAINT EVENT_ID_FK
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE CATEGORY_TO_EVENT
(
    ID VARCHAR(36) PRIMARY KEY,
    EVENT_CATEGORY_ID VARCHAR(36),
    EVENT_ID VARCHAR(36),
	CONSTRAINT EVENT_CATEGORY_ID_FK
	FOREIGN KEY (EVENT_CATEGORY_ID)
        REFERENCES EVENT_CATEGORIES(id),
	CONSTRAINT EVENT_ID_FK1
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE ORDERS
(
    ID VARCHAR(36) PRIMARY KEY,
    PERSON_ID VARCHAR(36),
    ORDER_STATUS_ID VARCHAR(36),
    PRICE INT,
    CURRENCY_ID VARCHAR(36),
    EVENT_ID VARCHAR(36),
    ORDER_DATE TIMESTAMP,
	FOREIGN KEY (PERSON_ID)
        REFERENCES PERSONS(id),
	FOREIGN KEY (ORDER_STATUS_ID)
        REFERENCES STATUSES(id),
	FOREIGN KEY (CURRENCY_ID)
        REFERENCES CURRENCIES(id),
	FOREIGN KEY (EVENT_ID)
        REFERENCES EVENTS(id)
);

CREATE TABLE LOT_TYPE_ATTRIBUTES
(
    ID VARCHAR(36) PRIMARY KEY,
    LOT_TYPE_ID VARCHAR(36),
    ATTR_NAME VARCHAR(255) NOT NULL,
    ATTR_TYPE VARCHAR(255) NOT NULL,
	CONSTRAINT LOT_TYPE_ID_FK1
	FOREIGN KEY (LOT_TYPE_ID)
        REFERENCES LOT_TYPES(id)
);

ALTER TABLE LOTS ADD FULLTEXT(NAME, DESCRIPTION);

--ГЕНЕРАЦИЯ ДАННЫХ

INSERT INTO STATUSES
(ID, TYPE, NAME)
VALUES
('3bfc3553-78f0-4f7e-a73e-5a90f15a1453', 'PERSON_STATUS', 'ACTIVE'),
('e365b26e-53bb-4c26-8adb-f0cbce259f89', 'PERSON_STATUS', 'PASSIVE'),
('f48c5f3b-a731-4959-aaf1-c4aacec44aae', 'LOT_STATUS', 'LOT_TRANSFER'),
('4eab6a77-b70c-4c32-8eff-71b5ace45628', 'LOT_STATUS', 'APPROVED'),
('d7849bd6-d5aa-4a3d-88b3-4d1f01759f26', 'LOT_STATUS', 'TRADING'),
('eccd8e66-96b6-4ffb-bcec-492f40cfa64e', 'LOT_STATUS', 'READY_FOR_TRADE'),
('ac181bfb-483d-48c1-bd9b-a7b6bb008c63', 'LOT_STATUS', 'CHEKING_FOR_TRADE'),
('52372740-722d-4fb6-bfcb-88330aebf9a3', 'LOT_STATUS', 'NEW'),
('8e30939c-337c-4d8e-b15e-11cf070f1ccb', 'EVENT_STATUS', 'ARCHIVED'),
('8c97f656-d157-45b7-99b0-ab3267dedc38', 'EVENT_STATUS', 'LOT_TRANSFER'),
('4d9d16eb-eac3-4077-88e6-1fb96b5744f0', 'EVENT_STATUS', 'APPROVED'),
('54eeccdc-efa9-4175-8b32-1c94f42aab2a', 'EVENT_STATUS', 'TRADING'),
('ba803104-4b6b-498c-b3ce-eaf0aebd3da7', 'EVENT_STATUS', 'IN_WORK'),
('5051fe22-ce89-4372-9c92-fcef5fe67ca3', 'EVENT_STATUS', 'CANCELED'),
('4eeee792-03cc-43fd-b9b0-bd02fcb449bf', 'ORDER_STATUS', 'APPVORED'),
('a4adf127-3557-4e2a-8ba6-cb976fde7768', 'ORDER_STATUS', 'BEATED'),
('05b0c452-fd4c-4049-8bb7-da1978213c7c', 'ORDER_STATUS', 'CANCELED')
;

INSERT INTO CURRENCIES
(ID, CODE, NAME)
VALUES
('b4f833a7-6783-4d61-bbf9-a94d2ef90073', 'RUB', 'RUSSIAN RUBLE'),
('288c19c5-890b-4894-b875-c9f234364451', 'USD', 'US DOLLAR')
;

INSERT INTO LOT_TYPES
(ID, PARENT_ID, NAME)
VALUES
('ed6e2264-6e30-4fb1-96ed-c246ff576ec4', NULL, 'ART'),
('31456ad9-b6af-4d24-bcbc-92dea7a5958b', 'ed6e2264-6e30-4fb1-96ed-c246ff576ec4', 'PICTUTE'),
('4b8ab58b-3ae5-4e77-96c2-e5be5c251a42', 'ed6e2264-6e30-4fb1-96ed-c246ff576ec4', 'STATUE')
;

INSERT INTO EVENT_TYPES
(ID, NAME)
VALUES
('a46a1824-2452-4f78-8172-7bdb794fc51f', 'SIMPLE TRADE')
;

INSERT INTO EVENT_CATEGORIES
(ID, NAME)
VALUES
('85da4265-d1da-4ea2-af40-a827a6cc14a9', 'TRADE_LESS_100_DOLLARS'),
('5eac8a8f-dca2-4ec1-a28e-226d78e36761', 'PREMIUM_TRADE'),
('d8e0e0ed-8659-47e2-82bb-cb9d8b8b33c5', 'ART_TRADING')
;

INSERT INTO PERSONS
(ID, NAME, SURNAME, PATRONYMIC, MAIL, PHONENUMBER, PERSON_STATUS_ID)
VALUES
('bab1df54-9dfa-4104-b8c3-fb9a9167d9d3', 'GEORGY', 'BASILADZE', 'TAMAZOVICH', 'BASILADZE@MAIL.RU', '9267257128', '3bfc3553-78f0-4f7e-a73e-5a90f15a1453'),
('33114217-ebaa-4bb4-a9f0-5f7f488dc8af', 'ANDRO', 'BASILADZE', 'TAMAZOVICH', 'ANDROBASILADZE@MAIL.RU', '9268168313', 'e365b26e-53bb-4c26-8adb-f0cbce259f89'),
('06b6b70b-8aa5-4da5-9604-fa38965c583c', 'DENIS', 'IVIN', 'VLADIMIROVICH', 'IVIN@GMAIL.COM', '9267257777', '3bfc3553-78f0-4f7e-a73e-5a90f15a1453')
;

INSERT INTO LOTS
(ID, NAME, DESCRIPTION, ATTRIBUTES, LOT_TYPE_ID, OWNER_ID, LOT_STATUS_ID)
VALUES
('c2dc0bd1-9c69-473f-9aa3-a27a680fe5bc', 'Siberian cat',  'Statue from factory LFZ - Siberian cat', '{"material": "ceramic", "producer": "LFZ"}', '4b8ab58b-3ae5-4e77-96c2-e5be5c251a42', 'bab1df54-9dfa-4104-b8c3-fb9a9167d9d3', 'eccd8e66-96b6-4ffb-bcec-492f40cfa64e'),
('5c8a4778-95d9-4f6d-a783-ad1258b83c5c', 'Gipsy',  'Statue from factory LFZ - Gipsy', '{"material": "porcelain", "producer": "LFZ"}', '4b8ab58b-3ae5-4e77-96c2-e5be5c251a42', 'bab1df54-9dfa-4104-b8c3-fb9a9167d9d3', 'eccd8e66-96b6-4ffb-bcec-492f40cfa64e'),
('93513556-89d4-4aac-8120-db3b97dc3392', 'Poet',  'Statue from factory LFZ - Poet', '{"material": "porcelain", "producer": "LFZ"}', '4b8ab58b-3ae5-4e77-96c2-e5be5c251a42', 'bab1df54-9dfa-4104-b8c3-fb9a9167d9d3', 'ac181bfb-483d-48c1-bd9b-a7b6bb008c63')
;

INSERT INTO EVENTS
(ID, DESCRIPTION, EVENT_STATUS_ID, EVENT_TYPE_ID, START_DATE, END_DATE, PRICE, CURRENCY_ID, PERSON_ID)
VALUES
('3f36cfa2-892a-4103-9ae8-a1e4211149f5', 'Auction rare statue LFZ', '54eeccdc-efa9-4175-8b32-1c94f42aab2a', 'a46a1824-2452-4f78-8172-7bdb794fc51f', '2020-12-27', '2020-12-29', 2500, '288c19c5-890b-4894-b875-c9f234364451', 'bab1df54-9dfa-4104-b8c3-fb9a9167d9d3')
;

INSERT INTO LOT_TO_EVENT
(ID, LOT_ID, EVENT_ID)
VALUES
('d72f706e-3768-450f-a8cf-40713a9eae38', 'c2dc0bd1-9c69-473f-9aa3-a27a680fe5bc', '3f36cfa2-892a-4103-9ae8-a1e4211149f5'),
('f3c49329-6a9a-4555-b66b-abc4b853a530', '5c8a4778-95d9-4f6d-a783-ad1258b83c5c', '3f36cfa2-892a-4103-9ae8-a1e4211149f5')
;

INSERT INTO ORDERS
(ID, PERSON_ID, ORDER_STATUS_ID, PRICE, CURRENCY_ID, EVENT_ID)
VALUES
('75afb751-45d4-43af-9d83-d1a1a2a5d352', '06b6b70b-8aa5-4da5-9604-fa38965c583c', 'a4adf127-3557-4e2a-8ba6-cb976fde7768', 700, 'b4f833a7-6783-4d61-bbf9-a94d2ef90073', '3f36cfa2-892a-4103-9ae8-a1e4211149f5'),
('5da446c6-d37a-4a90-9cc2-82205749f892', '33114217-ebaa-4bb4-a9f0-5f7f488dc8af', '4eeee792-03cc-43fd-b9b0-bd02fcb449bf', 1200, 'b4f833a7-6783-4d61-bbf9-a94d2ef90073', '3f36cfa2-892a-4103-9ae8-a1e4211149f5')
;
